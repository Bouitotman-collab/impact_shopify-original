{%- if section.settings.text != blank -%}
  {%- render 'section-spacing-collapsing' -%}

  <style>
    #shopify-section-{{ section.id }} {
      --section-spacing-inline: 0;
      --scrolling-text-font-size: {% if section.settings.text_size == 'xsmall' %}0.9rem{% elsif section.settings.text_size == 'small' %}1.5rem{% elsif section.settings.text_size == 'medium' %}2.5rem{% elsif section.settings.text_size == 'large' %}3rem{% else %}4rem{% endif %};
    }

    @media screen and (min-width: 700px) {
      #shopify-section-{{ section.id }} {
        --scrolling-text-font-size: {% if section.settings.text_size == 'xsmall' %}1rem{% elsif section.settings.text_size == 'small' %}2rem{% elsif section.settings.text_size == 'medium' %}3rem{% elsif section.settings.text_size == 'large' %}4rem{% else %}5rem{% endif %};
      }
    }

    /* TEXTE : Regular + centrage vertical + phrases séparées */
    #shopify-section-{{ section.id }} .scrolling-text__text {
      display: inline-block;       /* chaque phrase est un bloc séparé */
      font-weight: 400;            /* Regular */
      line-height: 1;
      vertical-align: middle;      /* centrage vertical */
      margin-right: 2rem;          /* espace entre phrases */
    }

    /* POINTS : espace avant/après uniquement pour les points */
    #shopify-section-{{ section.id }} .scrolling-text__text .dot-separator {
      margin: 0 0.5rem;            /* espace avant et après le point */
      display: inline-block;
    }

    /* Réduction des bords / marges verticales */
    #shopify-section-{{ section.id }} .section {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
  </style>

  {%- if section.settings.text_size == 'xsmall' -%}
    {%- assign is_tight = true -%}
  {%- endif -%}

  <div {% render 'section-properties', tight: is_tight %}>
    {%- capture section_content -%}
      {%- assign phrases = section.settings.text | split: '•' -%}
      {%- for phrase in phrases -%}
        <span class="scrolling-text__text">
          {{ phrase | strip }}
          {% unless forloop.last %}
            <span class="dot-separator">•</span>
          {% endunless %}
        </span>
      {%- endfor -%}
    {%- endcapture -%}

    <div class="scrolling-text {% if section.settings.scrolling_mode == 'scroll' %}scrolling-text--scroll{% else %}scrolling-text--auto{% endif %}">
      {%- if section.settings.scrolling_mode == 'scroll' -%}
        <scrolling-text class="scrolling-text__wrapper">
          {{- section_content -}}
        </scrolling-text>
      {%- else -%}
        <marquee-text scrolling-speed="{{ section.settings.scrolling_speed }}" class="scrolling-text__wrapper">
          {{- section_content -}}
        </marquee-text>
      {%- endif -%}
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Scrolling text",
  "class": "shopify-section--scrolling-text",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width", "default": true },
    { "type": "text", "id": "text", "label": "Text", "default": "SPÉCIAL PROPRIÉTAIRES D'ANIMAUX • ÉLIMINE ODEURS, POILS ET RÉSIDUS INCRUSTÉS • NETTOIE EN PROFONDEUR — 1 CYCLE SUFFIT • EFFICACE DÈS LE PREMIER LAVAGE • PROTÈGE VOTRE MACHINE • COMPATIBLE TOUTES MACHINES • FORMULE CERTIFIÉE ÉCOLOGIQUE" },
    { "type": "select", "id": "text_size", "label": "Text size",
      "options": [
        { "value": "xsmall", "label": "X-Small" },
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" },
        { "value": "xlarge", "label": "X-Large" }
      ],
      "default": "large"
    },
    { "type": "select", "id": "text_style", "label": "Text style",
      "options": [ { "value": "outline", "label": "Outline" }, { "value": "fill", "label": "Fill" } ],
      "default": "fill"
    },
    { "type": "select", "id": "scrolling_mode", "label": "Scrolling mode",
      "options": [ { "value": "auto", "label": "Automatic" }, { "value": "scroll", "label": "On scroll" } ],
      "default": "auto"
    },
    { "type": "range", "id": "scrolling_speed", "min": 3, "max": 20, "step": 1, "unit": "s", "label": "Automatic scrolling speed", "default": 10 },
    { "type": "header", "content": "Colors", "info": "Gradient replaces solid colors when set. Gradient text outline and gradient background cannot be combined." },
    { "type": "color", "id": "background", "label": "Background" },
    { "type": "color_background", "id": "background_gradient", "label": "Background gradient" },
    { "type": "color", "id": "text_color", "label": "Text" },
    { "type": "color_background", "id": "text_gradient", "label": "Text gradient" }
  ],
  "presets": [ { "name": "Scrolling text" } ]
}
{% endschema %}
